"use strict";!function(){function a(a,c){function m(b){return b.data.checkingPresence&&a.channels[b.userid]?(a.channels[b.userid].send({presenceDetected:!0}),void 0):b.data.presenceDetected&&a.peers[b.userid]?(a.peers[b.userid].connected=!0,void 0):("text"===b.data.type?k.receive(b.data,b.userid,b.extra):a.autoTranslateText?(b.original=b.data,a.Translator.TranslateText(b.data,function(c){b.data=c,a.onmessage(b)})):a.onmessage(b),void 0)}function n(b){return a.skipOnNewSession||(b.session||(b.session={}),b.extra||(b.extra={}),a.sessionid&&b.sessionid!==a.sessionid)?void 0:a.onNewSession?(b.join=function(c){if(!c)return a.join(b);for(var d in c)b.session[d]=c[d];var e=a.dontCaptureUserMedia;a.dontCaptureUserMedia=!1,a.captureUserMedia(function(){a.dontCaptureUserMedia=!0,a.join(b),a.dontCaptureUserMedia=e},c)},b.extra||(b.extra={}),a.onNewSession(b)):(a.join(b),void 0)}function o(b){for(var c=0;c<a.localStreamids.length;c++){var d=a.localStreamids[c];a.streams[d]&&a.streams[d].sockets.push(b)}}function x(b){function u(b){return j||i||!q(a.waitUntilRemoteStreamStartsFlowing)&&a.waitUntilRemoteStreamStartsFlowing===!1?z(b):(b.numberOfTimes||(b.numberOfTimes=0),b.numberOfTimes++,b.mediaElement.readyState<=window.HTMLMediaElement.HAVE_CURRENT_DATA||b.mediaElement.paused||b.mediaElement.currentTime<=0?b.numberOfTimes>=60?c.send({failedToReceiveRemoteVideo:!0,streamid:b.stream.streamid}):(setTimeout(function(){y("Waiting for incoming remote stream to be started flowing: "+b.numberOfTimes+" seconds."),u(b)},900),void 0):z(b))}function x(){if(a.fakeDataChannels&&!a.channels[b.userid]&&!a.session.data){var d={send:function(a){c.send({fakeData:a})},readyState:"open"};a.channels[b.userid]={channel:d,send:function(a){this.channel.send(a)}},n.onopen(d)}}function z(d){var e=d.mediaElement,f=d.session,g=d.stream;g.onended=function(){h.mediaElement&&!h.mediaElement.parentNode&&document.getElementById(g.streamid)&&(h.mediaElement=document.getElementById(g.streamid)),F(h,a)};var h={mediaElement:e,stream:g,streamid:g.streamid,session:f||a.session,blobURL:i?"":e.mozSrcObject?URL.createObjectURL(g):e.src,type:"remote",extra:b.extra,userid:b.userid,isVideo:i?!!f.video:!!g.isVideo,isAudio:i?!!f.audio&&!f.video:!!g.isAudio,isScreen:!!g.isScreen,isInitiator:!!b.isInitiator,rtcMultiConnection:a,socket:c};if(a.streams[g.streamid]=a._getStream(h),a.onstream(h),!s(d.preMuted)&&(d.preMuted.audio||d.preMuted.video)){var j=K({},h);j.session=K(j.session,d.preMuted),j.isAudio=!!j.session.audio&&!j.session.video,j.isVideo=!!j.session.video,j.isScreen=!1,a.onmute(j)}y("on:add:stream",h),P(),a.onspeaking&&$({stream:g,streamedObject:h,connection:a})}function J(c){b.channel=c,a.channels[b.userid]={channel:b.channel,send:function(b){a.send(b,this.channel)}},a.onopen({extra:b.extra,userid:b.userid,channel:c});for(var d in a.fileQueue)a.send(a.fileQueue[d],c);p(a.session)&&P(),a.partOfScreen&&a.partOfScreen.sharing&&a.peers[b.userid].sharePartOfScreen(a.partOfScreen)}function O(){c.userid!==b.userid&&(c.userid=b.userid,a.numberOfConnectedUsers++,a.peers[b.userid]={socket:c,peer:l,userid:b.userid,extra:b.extra,userinfo:b.userinfo,addStream:function(b){a.addStream(b,this.socket)},removeStream:function(b){return a.streams[b]?(this.peer.connection.removeStream(a.streams[b].stream),this.renegotiate(),void 0):A("No such stream exists. Stream-id:",b)},renegotiate:function(b,c){a.renegotiate(b,c)},changeBandwidth:function(a){if(!a)throw"You MUST pass bandwidth object.";if(r(a))throw"Pass object for bandwidth instead of string; e.g. {audio:10, video:20}";this.peer.bandwidth=a,this.socket.send({changeBandwidth:!0,bandwidth:a})},sendCustomMessage:function(a){this.socket.send({customMessage:!0,message:a})},onCustomMessage:function(a){y('Received "private" message from',this.userid,r(a)?a:B(a))},drop:function(b){for(var c in a.streams)-1===a._skip.indexOf(c)&&(c=a.streams[c],c.userid===a.userid&&"local"===c.type&&(this.peer.connection.removeStream(c.stream),F(c,a)),"remote"===c.type&&c.userid===this.userid&&F(c,a));b||this.socket.send({drop:!0})},hold:function(b){return"answer"===l.prevCreateType?(this.socket.send({unhold:!0,holdMLine:b||"both",takeAction:!0}),void 0):(this.socket.send({hold:!0,holdMLine:b||"both"}),this.peer.hold=!0,this.fireHoldUnHoldEvents({kind:b,isHold:!0,userid:a.userid,remoteUser:this.userid}),void 0)},unhold:function(b){return"answer"===l.prevCreateType?(this.socket.send({unhold:!0,holdMLine:b||"both",takeAction:!0}),void 0):(this.socket.send({unhold:!0,holdMLine:b||"both"}),this.peer.hold=!1,this.fireHoldUnHoldEvents({kind:b,isHold:!1,userid:a.userid,remoteUser:this.userid}),void 0)},fireHoldUnHoldEvents:function(b){var c=b.isHold,d=b.kind,e=b.remoteUser||b.userid;for(var f in a.streams)-1===a._skip.indexOf(f)&&(f=a.streams[f],f.userid===e&&(c&&a.onhold(K({kind:d},f)),c||a.onunhold(K({kind:d},f))))},redial:function(){for(var b in a.streams)-1===a._skip.indexOf(b)&&(b=a.streams[b],b.userid===this.userid&&"remote"===b.type&&F(b,a));y("ReDialing..."),c.send({recreatePeer:!0}),l=new gb,l.create("offer",n)},sharePartOfScreen:function(b){function e(){return c.stopPartOfScreenSharing?(c.stopPartOfScreenSharing=!1,a.onpartofscreenstopped&&a.onpartofscreenstopped(),void 0):c.pausePartOfScreenSharing?(a.onpartofscreenpaused&&a.onpartofscreenpaused(),setTimeout(e,b.interval||200)):(M({element:b.element,connection:a,callback:function(f){if(!a.channels[c.userid])throw"No such data channel exists.";f!==d&&(d=f,a.channels[c.userid].send({screenshot:f,isPartOfScreen:!0})),b.once||setTimeout(e,b.interval||200)}}),void 0)}var c=this,d="";e()},getConnectionStats:function(b,c){function d(){db.prototype.getConnectionStats=window.getConnectionStats,l.connection&&l.connection.getConnectionStats(b,c)}if(!b)throw"callback is mandatory.";window.getConnectionStats?d():L(a.resources.getConnectionStats,d)},takeSnapshot:function(b){I({userid:this.userid,connection:a,callback:b})}})}function P(){if(a.isInitiator&&C(f)&&C(f)<=a.maxParticipantsAllowed&&(a.session.oneway||a.session.broadcast||a.socket.send({sessionid:a.sessionid,newParticipant:b.userid||c.channel,userData:{userid:b.userid||c.channel,extra:b.extra}})),"chrome"===b.userinfo.browser&&!b.renegotiatedOnce)for(var d in a.renegotiatedSessions)b.renegotiatedOnce=!0,a.renegotiatedSessions[d]&&a.renegotiatedSessions[d].stream&&a.peers[b.userid].renegotiate(a.renegotiatedSessions[d].stream,a.renegotiatedSessions[d].session)}function Q(g){if(!Y&&g.userid!==a.userid){if(g.sdp){b.userid=g.userid,b.extra=g.extra||{},b.renegotiate=g.renegotiate,b.streaminfo=g.streaminfo,b.isInitiator=g.isInitiator,b.userinfo=g.userinfo;var h=JSON.parse(g.sdp);"offer"===h.type&&(n.preferSCTP=!!g.preferSCTP,a.fakeDataChannels=!!g.fakeDataChannels),x(),R(h,g.labels)}if(g.candidate&&l&&l.addIceCandidate(JSON.parse(g.candidate)),g.streamid&&(d.streamids||(d.streamids={}),d.streamids[g.streamid]||(d.streamids[g.streamid]=g.streamid,a.onstreamid(g))),g.mute||g.unmute)if(g.promptMuteUnmute){if(!a.privileges.canMuteRemoteStream)return a.onstatechange({userid:g.userid,extra:g.extra,name:"mute-request-denied",reason:g.userid+' tried to mute your stream; however "privileges.canMuteRemoteStream" is "false".'}),void 0;a.streams[g.streamid]&&(g.mute&&!a.streams[g.streamid].muted&&a.streams[g.streamid].mute(g.session),g.unmute&&a.streams[g.streamid].muted&&a.streams[g.streamid].unmute(g.session))}else{var i={};a.streams[g.streamid]&&(i=a.streams[g.streamid]);var j=g.session,k=K({},i);k.session=j,k.isAudio=!!k.session.audio&&!k.session.video,k.isVideo=!!k.session.video,k.isScreen=!!k.session.screen,g.mute&&a.onmute(k||g),g.unmute&&a.onunmute(k||g)}if(g.isVolumeChanged&&(y("Volume of stream: "+g.streamid+" has changed to: "+g.volume),a.streams[g.streamid])){var m=a.streams[g.streamid].mediaElement;m&&(m.volume=g.volume)}if(g.stopped&&a.streams[g.streamid]&&F(a.streams[g.streamid],a),g.promptStreamStop){if(!a.privileges.canStopRemoteStream)return a.onstatechange({userid:g.userid,extra:g.extra,name:"stop-request-denied",reason:g.userid+' tried to stop your stream; however "privileges.canStopRemoteStream" is "false".'}),void 0;A("Remote stream has been manually stopped!"),a.streams[g.streamid]&&a.streams[g.streamid].stop()}if(g.left){if(e){var o=g.userid;for(var p in a.streams)p=a.streams[p],p.userid===o&&(a.stopMediaStream(p),F(p,a))}if(l&&l.connection&&("closed"!==l.connection.signalingState&&-1===l.connection.iceConnectionState.search(/disconnected|failed/gi)&&l.connection.close(),l.connection=null),f[g.userid]&&delete f[g.userid],g.closeEntireSession)return a.onSessionClosed(g),a.leave(),void 0;a.remove(g.userid),H({userid:g.userid,extra:g.extra||{},entireSessionClosed:!!g.closeEntireSession},a),w.forEach(function(a,b){a===Q&&delete w[b]}),w=v(w)}if(g.changeBandwidth){if(!a.peers[g.userid])throw"No such peer exists.";a.peers[g.userid].peer.bandwidth=g.bandwidth,a.peers[g.userid].renegotiate()}if(g.customMessage){if(!a.peers[g.userid])throw"No such peer exists.";if(g.message.ejected){if(a.sessionDescriptions[a.sessionid].userid!==g.userid)throw"only initiator can eject a user.";a.leave(),a.onSessionClosed({userid:g.userid,extra:g.extra||b.extra,isEjected:!0})}else a.peers[g.userid].onCustomMessage(g.message)}if(g.drop){if(!a.peers[g.userid])throw"No such peer exists.";a.peers[g.userid].drop(!0),a.peers[g.userid].renegotiate(),a.ondrop(g.userid)}if(g.hold||g.unhold){if(!a.peers[g.userid])throw"No such peer exists.";if(g.takeAction)return a.peers[g.userid][g.hold?"hold":"unhold"](g.holdMLine),void 0;a.peers[g.userid].peer.hold=!!g.hold,a.peers[g.userid].peer.holdMLine=g.holdMLine,c.send({isRenegotiate:!0}),a.peers[g.userid].fireHoldUnHoldEvents({kind:g.holdMLine,isHold:!!g.hold,userid:g.userid})}g.isRenegotiate&&a.peers[g.userid].renegotiate(null,a.peers[g.userid].peer.session),g.fakeData&&n.onmessage(g.fakeData),g.recreatePeer&&(l=new gb),g.failedToReceiveRemoteVideo&&(y("Remote peer hasn't received stream: "+g.streamid+". Renegotiating..."),a.peers[g.userid]&&a.peers[g.userid].renegotiate()),g.redial&&a.peers[g.userid]&&("disconnected"!==a.peers[g.userid].peer.connection.iceConnectionState&&(b.redialing=!1),"disconnected"!==a.peers[g.userid].peer.connection.iceConnectionState||b.redialing||(b.redialing=!0,A("Peer connection is closed.",B(a.peers[g.userid].peer.connection),"ReDialing.."),a.peers[g.userid].redial()))}}function R(d,f){function i(){return e||"firefox"===b.userinfo.browser?(a.peers[b.userid]&&a.peers[b.userid].redial(),void 0):(l.recreateAnswer(d,h,function(b,d){G({sdp:b,socket:c,streaminfo:d}),a.detachStreams=[]}),void 0)}if("answer"===d.type)return l.setRemoteDescription(d),O(),void 0;if(!b.renegotiate&&"offer"===d.type)return n.offerDescription=d,n.session=a.session,l||(l=new gb),l.create("answer",n),O(),void 0;var h=b.renegotiate;if(E(f,l.connection),h.oneway||p(h))i(),delete b.renegotiate;else{if(b.capturing)return;b.capturing=!0,a.captureUserMedia(function(c){b.capturing=!1,(g||e&&!l.connection.getLocalStreams().length)&&l.addStream(c),a.renegotiatedSessions[JSON.stringify(b.renegotiate)]={session:b.renegotiate,stream:c},delete b.renegotiate,i()},b.renegotiate)}}var c=a.socket;w.push(Q);var l,k=b.isCreateOffer,n={onopen:J,onicecandidate:function(b){if(!a.candidates)throw"ICE candidates are mandatory.";if(!a.iceProtocols)throw"At least one must be true; UDP or TCP.";var d=a.candidates,e=d.stun,f=d.turn;if(q(d.reflexive)||(e=d.reflexive),q(d.relay)||(f=d.relay),!(!d.host&&b.candidate.match(/typ host/g)||!f&&b.candidate.match(/typ relay/g)||!e&&b.candidate.match(/typ srflx/g))){var g=a.iceProtocols;(g.udp||!b.candidate.match(/ udp /g))&&(g.tcp||!b.candidate.match(/ tcp /g))&&(window.selfNPObject||(window.selfNPObject=b),c&&c.send({candidate:JSON.stringify({candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex})}))}},onmessage:function(c){if(c){var e=t(c);if(-1!==e.indexOf('"userid":'))e=JSON.parse(e),m(e);else if(c instanceof ArrayBuffer||c instanceof DataView){if(!a.enableFileSharing)throw'It seems that receiving data is either "Blob" or "File" but file sharing is disabled.';if(!d.fileBufferReader){var f=this;return N(a,function(a){d.fileBufferReader=a,f.onmessage(c)}),void 0}var g=d.fileBufferReader;return g.convertToObject(c,function(c){return c.maxChunks||c.readyForNextChunk?c.readyForNextChunk?(g.getNextChunk(c.uuid,function(a){d.send(a)}),void 0):(g.addChunk(c,function(a){d.send(a)}),void 0):(a.onmessage({data:c,userid:b.userid,extra:b.extra}),void 0)}),void 0}}},onaddstream:function(c,d){function f(){setTimeout(function(){k.muted=!1,z({mediaElement:k,session:d,stream:c,preMuted:e})},3e3),k.removeEventListener("play",f)}if(d=d||b.renegotiate||a.session,!p(d)){d.screen&&(d.audio||d.video)&&(b.gotAudioOrVideo?(d.audio=!1,d.video=!1):(b.gotAudioOrVideo=!0,d.screen=!1));var e={};if(b.streaminfo){var g=b.streaminfo.split("----"),j=JSON.parse(g[g.length-1]);h||(c.streamid=j.streamid,c.isScreen=!!j.isScreen,c.isVideo=!!j.isVideo,c.isAudio=!!j.isAudio,e=j.preMuted),g.pop(),b.streaminfo=g.join("----")}var k=D(c,K({remote:!0},d));return a.setDefaultEventsForMediaElement&&a.setDefaultEventsForMediaElement(k,c.streamid),i||c.getVideoTracks().length?(u({mediaElement:k,session:d,stream:c,preMuted:e}),void 0):k.addEventListener("play",f,!1)}},onremovestream:function(b){b&&b.streamid?(b=a.streams[b.streamid],b&&(y("on:stream:ended via on:remove:stream",b),F(b,a))):y("on:remove:stream",b)},onclose:function(c){c.extra=b.extra,c.userid=b.userid,a.onclose(c),a.channels[c.userid]&&delete a.channels[c.userid]},onerror:function(c){c.extra=b.extra,c.userid=b.userid,a.onerror(c)},oniceconnectionstatechange:function(c){y("oniceconnectionstatechange",B(c)),l.connection&&"connected"===l.connection.iceConnectionState&&"complete"===l.connection.iceGatheringState&&"stable"===l.connection.signalingState&&1===a.numberOfConnectedUsers&&a.onconnected({userid:b.userid,extra:b.extra,peer:a.peers[b.userid],targetuser:b.userinfo}),!a.isInitiator&&l.connection&&"connected"===l.connection.iceConnectionState&&"complete"===l.connection.iceGatheringState&&"stable"===l.connection.signalingState&&1===a.numberOfConnectedUsers&&a.onstatechange({userid:b.userid,extra:b.extra,name:"connected-with-initiator",reason:"ICE connection state seems connected; gathering state is completed; and signaling state is stable."}),a.peers[b.userid]&&a.peers[b.userid].oniceconnectionstatechange&&a.peers[b.userid].oniceconnectionstatechange(c),a.peers[b.userid]&&a.peers[b.userid].peer&&"failed"===a.peers[b.userid].peer.connection.iceConnectionState&&a.onfailed({userid:b.userid,extra:b.extra,peer:a.peers[b.userid],targetuser:b.userinfo}),a.peers[b.userid]&&"disconnected"===a.peers[b.userid].peer.connection.iceConnectionState&&(l.connection.renegotiate||a.ondisconnected({userid:b.userid,extra:b.extra,peer:a.peers[b.userid],targetuser:b.userinfo}),l.connection.renegotiate=!1),a.autoReDialOnFailure&&a.peers[b.userid]&&("disconnected"!==a.peers[b.userid].peer.connection.iceConnectionState&&(b.redialing=!1),"disconnected"!==a.peers[b.userid].peer.connection.iceConnectionState||b.redialing||(b.redialing=!0,A("Peer connection is closed.",B(a.peers[b.userid].peer.connection),"ReDialing.."),a.peers[b.userid].socket.send({redial:!0}),a.streams.remove({remote:!0,userid:b.userid})))},onsignalingstatechange:function(a){y("onsignalingstatechange",B(a))},attachStreams:a.dontAttachStream?[]:a.attachStreams,iceServers:a.iceServers,rtcConfiguration:a.rtcConfiguration,bandwidth:a.bandwidth,sdpConstraints:a.sdpConstraints,optionalArgument:a.optionalArgument,disableDtlsSrtp:a.disableDtlsSrtp,dataChannelDict:a.dataChannelDict,preferSCTP:a.preferSCTP,onSessionDescription:function(a,b){G({sdp:a,socket:c,streaminfo:b})},trickleIce:a.trickleIce,processSdp:a.processSdp,sendStreamId:function(a){c&&c.send({streamid:a.streamid,isScreen:!!a.isScreen,isAudio:!!a.isAudio,isVideo:!!a.isVideo})},rtcMultiConnection:a};k&&!l&&(n.session=a.session,l||(l=new gb),l.create("offer",n)),o(c),c.__push||(c.__push=c.send,c.send=function(b){b.userid=b.userid||a.userid,b.extra=b.extra||a.extra||{},c.__push(b)})}function E(b,c){if(b)for(var d=0;d<b.length;d++){var e=b[d];a.streams[e]&&c.removeStream(a.streams[e].stream)}}function G(b){b.socket.send({sdp:JSON.stringify({sdp:b.sdp.sdp,type:b.sdp.type}),renegotiate:b.renegotiate?b.renegotiate:!1,streaminfo:b.streaminfo||"",labels:b.labels||[],preferSCTP:!!a.preferSCTP,fakeDataChannels:!!a.fakeDataChannels,isInitiator:!!a.isInitiator,userinfo:{browser:e?"firefox":"chrome"}})}function O(b){var c=b.newParticipant;if(c&&!f[c]&&c!==a.userid){var d=a.token();x({channel:d,extra:b.userData?b.userData.extra:b.extra,userid:b.userData?b.userData.userid:b.userid}),a.socket.send({participant:!0,targetUser:c,channel:d})}}function P(){var c={left:!0,extra:a.extra||{},userid:a.userid,sessionid:a.sessionid};if(a.isInitiator)if(a.autoCloseEntireSession)c.closeEntireSession=!0;else{var d;for(var e in a.peers)e===a.userid||(d=a.peers[e]);d&&d.socket.send({isPlayRoleOfInitiator:!0,messageFor:d.userid,userid:a.userid,extra:a.extra,participants:f})}a.socket.send(c),a.refresh(),b.forEach(function(a){a.disconnect()}),b=[]}function R(){d.signalingReady||(d.signalingReady=!0,setTimeout(c,1e3))}function T(b){for(var c in b)f[b[c]]||O({sessionid:a.sessionid,newParticipant:b[c],userid:a.userid,extra:a.extra})}function U(){var b=0;256!==a.maxParticipantsAllowed&&(b=a.maxParticipantsAllowed),"one-way"===a.direction&&(a.session.oneway=!0),"one-to-one"===a.direction&&(a.maxParticipantsAllowed=1),"one-to-many"===a.direction&&(a.session.broadcast=!0),"many-to-many"===a.direction&&(a.maxParticipantsAllowed&&1!==a.maxParticipantsAllowed||(a.maxParticipantsAllowed=256)),b&&1!==a.maxParticipantsAllowed&&(a.maxParticipantsAllowed=b)}function V(b){if(!d.donotJoin||d.donotJoin!==b.sessionid){a.dontOverrideSession||(a.session=b.session||{}),d.broadcasterid=b.userid,b.sessionid&&(a.sessionid=b.sessionid),a.isAcceptNewSession=!1;var c=l();x({channel:c,extra:b.extra||{},userid:b.userid});var e={};if(a.attachStreams.length){var f=a.attachStreams[a.attachStreams.length-1];f.getAudioTracks&&f.getAudioTracks().length&&(e.audio=!0),f.getVideoTracks().length&&(e.video=!0)}s(e)?y("Seems data-only connection."):y(B(e)),a.onstatechange({userid:b.userid,extra:{},name:"connecting-with-initiator",reason:"Checking presence of the initiator; and the room."}),a.socket.send({participant:!0,channel:c,targetUser:b.userid,session:a.session,offers:{audio:!!e.audio,video:!!e.video}}),a.skipOnNewSession=!1,J(a)}}function W(b){if(d.requestsFrom||(d.requestsFrom={}),!d.requestsFrom[b.userid]){var c={userid:b.userid,extra:b.extra,channel:b.channel||b.userid,session:b.session||a.session};if(b.offers){b.offers.audio&&b.offers.video?y("target user has both audio/video streams."):b.offers.audio&&!b.offers.video?y("target user has only audio stream."):!b.offers.audio&&b.offers.video?y("target user has only video stream."):y("target user has no stream; it seems one-way streaming or data-only connection.");var e=a.sdpConstraints.mandatory;q(e.OfferToReceiveAudio)&&(a.sdpConstraints.mandatory.OfferToReceiveAudio=!!b.offers.audio),q(e.OfferToReceiveVideo)&&(a.sdpConstraints.mandatory.OfferToReceiveVideo=!!b.offers.video),y("target user's SDP has?",B(a.sdpConstraints.mandatory))}d.requestsFrom[b.userid]=c,a.onRequest&&a.isInitiator?a.onRequest(c):X(c)}}function X(b){return d.captureUserMediaOnDemand?(d.captureUserMediaOnDemand=!1,a.captureUserMedia(function(){X(b),J(a)}),void 0):(y("accepting request from",b.userid),f[b.userid]=b.userid,x({isCreateOffer:!0,userid:b.userid,channel:b.channel,extra:b.extra||{},session:b.session||a.session}),void 0)}var d=this,f={};!d.fileBufferReader&&a.session.data&&a.enableFileSharing&&N(a,function(a){d.fileBufferReader=a});var k=new ib(a),w=[];a.playRoleOfInitiator=function(){a.dontCaptureUserMedia=!0,a.open(),a.dontCaptureUserMedia=!1},a.askToShareParticipants=function(){a.socket&&a.socket.send({askToShareParticipants:!0})},a.shareParticipants=function(b){var c={joinUsers:f,userid:a.userid,extra:a.extra};b&&(b.dontShareWith&&(c.dontShareWith=b.dontShareWith),b.shareWith&&(c.shareWith=b.shareWith)),a.socket.send(c)},a.remove=function(b){d.requestsFrom&&d.requestsFrom[b]&&delete d.requestsFrom[b],a.peers[b]&&(a.peers[b].peer&&a.peers[b].peer.connection&&("closed"!==a.peers[b].peer.connection.signalingState&&a.peers[b].peer.connection.close(),a.peers[b].peer.connection=null),delete a.peers[b]),f[b]&&delete f[b];for(var c in a.streams){var e=a.streams[c];e.userid===b&&(F(e,a),delete a.streams[c])}},a.refresh=function(){a.isInitiator&&a.socket&&a.socket.remove&&a.socket.remove(),f={};for(var b=0;b<a.attachStreams.length;b++)a.stopMediaStream(a.attachStreams[b]);bb={streams:[],mutex:!1,queueRequests:[]},d.isOwnerLeaving=!0,a.isInitiator=!1,a.isAcceptNewSession=!0,a.attachMediaStreams=[],a.sessionDescription=null,a.sessionDescriptions={},a.localStreamids=[],a.preRecordedMedias={},a.snapshots={},a.numberOfConnectedUsers=0,a.numberOfSessions=0,a.attachStreams=[],a.detachStreams=[],a.fileQueue={},a.channels={},a.renegotiatedSessions={};for(var c in a.peers)c!==a.userid&&delete a.peers[c];for(var e in a.streams)-1===a._skip.indexOf(e)&&(F(a.streams[e],a),delete a.streams[e]);f={}},a.reject=function(b){r(b)||(b=b.userid),a.socket.send({rejectedRequestOf:b}),a.remove(b)},d.leaveHandler=function(b){return a.leaveOnPageUnload?q(b.keyCode)?P():(116===b.keyCode&&P(),void 0):void 0},Z("beforeunload",d.leaveHandler),Z("keyup",d.leaveHandler),a.socket=a.openSignalingChannel({onmessage:function(b){if(w.forEach(function(a){a(b)}),!Y&&b.userid!==a.userid){if(b.sessionid&&b.userid&&(a.sessionDescriptions[b.sessionid]||(a.numberOfSessions++,a.sessionDescriptions[b.sessionid]=b,a.isAcceptNewSession&&(a.dontOverrideSession||(a.session=b.session),n(b)))),b.newParticipant&&!a.isAcceptNewSession&&d.broadcasterid===b.userid&&b.newParticipant!==a.userid&&O(b),C(f)<a.maxParticipantsAllowed&&b.targetUser===a.userid&&b.participant){if(a.peers[b.userid]&&!a.peers[b.userid].peer)return delete f[b.userid],delete a.peers[b.userid],a.isAcceptNewSession=!0,W(b);f[b.userid]||W(b)}if(b.acceptedRequestOf===a.userid&&a.onstatechange({userid:b.userid,extra:b.extra,name:"request-accepted",reason:b.userid+" accepted your participation request."}),b.rejectedRequestOf===a.userid&&a.onstatechange({userid:b.userid,extra:b.extra,name:"request-rejected",reason:b.userid+" rejected your participation request."}),b.customMessage)if(b.message.drop){a.ondrop(b.userid),a.attachStreams=[];for(var c in a.streams)-1===a._skip.indexOf(c)&&(c=a.streams[c],"local"===c.type?(a.detachStreams.push(c.streamid),F(c,a)):F(c,a));b.message.renegotiate&&a.renegotiate()}else a.onCustomMessage&&a.onCustomMessage(b.message);if(b.sessionDescription&&b.responseFor===a.userid){var e=b.sessionDescription;a.sessionDescriptions[e.sessionid]||(a.numberOfSessions++,a.sessionDescriptions[e.sessionid]=e)}a.isInitiator&&b.askToShareParticipants&&a.socket&&a.shareParticipants({shareWith:b.userid}),b.shareWith===a.userid&&b.dontShareWith!==a.userid&&b.joinUsers&&T(b.joinUsers),!b.shareWith&&b.joinUsers&&(b.dontShareWith?a.userid!==b.dontShareWith&&T(b.joinUsers):T(b.joinUsers)),b.messageFor===a.userid&&b.presenceState&&("checking"===b.presenceState&&(a.socket.send({messageFor:b.userid,presenceState:"available",_config:b._config}),y("participant asked for availability")),"available"===b.presenceState&&(d.presenceState="available",a.onstatechange({userid:"browser",extra:{},name:"room-available",reason:"Initiator is available and room is active."}),V(b._config))),b.donotJoin&&b.messageFor===a.userid&&y(b.userid,"is not joining your room."),b.isDisconnectSockets&&(y("Disconnecting your sockets because initiator also disconnected his sockets."),a.disconnect()),b.isPlayRoleOfInitiator&&b.messageFor===a.userid&&(b.extra&&(a.extra=K(a.extra,b.extra)),b.participants&&(f=b.participants,f[a.userid]&&delete f[a.userid]),setTimeout(a.playRoleOfInitiator,2e3))}},callback:function(a){a&&this.onopen(a)},onopen:function(b){b&&(a.socket=b),R&&R(),a.socket.__push||(a.socket.__push=a.socket.send,a.socket.send=function(b){b.userid=b.userid||a.userid,b.extra=b.extra||a.extra||{},a.socket.__push(b)})}}),a.socket&&R&&setTimeout(R,2e3),a.session.screen&&Q(),a.getExternalIceServers&&S(function(b){a.iceServers=a.iceServers.concat(b)}),a.log===!1&&a.skipLogs(),a.onlog&&(y=A=z=function(){var b={},c=0;Array.prototype.slice.call(arguments).forEach(function(a){b[c++]=B(a)}),B=function(a){return a},a.onlog(b)}),this.initSession=function(b){function c(){a.socket&&C(f)<a.maxParticipantsAllowed&&!d.isOwnerLeaving&&a.socket.send(a.sessionDescription),a.transmitRoomOnce||d.isOwnerLeaving||setTimeout(c,a.interval||3e3)}d.isOwnerLeaving=!1,U(),f={},d.isOwnerLeaving=!1,q(b.transmitRoomOnce)||(a.transmitRoomOnce=b.transmitRoomOnce),b.dontTransmit||c()},this.joinSession=function(b){function c(){a.socket.send({messageFor:b.userid,presenceState:d.presenceState,_config:{userid:b.userid,extra:b.extra||{},sessionid:b.sessionid,session:b.session||!1}})}function e(){"checking"===d.presenceState&&(A("Unable to reach initiator. Trying again..."),c(),setTimeout(function(){"checking"===d.presenceState&&(a.onstatechange({userid:b.userid,extra:b.extra||{},name:"room-not-available",reason:"Initiator seems absent. Waiting for someone to open the room."}),a.isAcceptNewSession=!0,setTimeout(e,2e3))},2e3))}return a.socket?(b=b||{},f={},d.presenceState="checking",a.onstatechange({userid:b.userid,extra:b.extra||{},name:"detecting-room-presence",reason:"Checking presence of the room."}),c(),setTimeout(e,3e3),void 0):setTimeout(function(){A("Default-Socket is not yet initialized."),d.joinSession(b)},1e3)},a.donotJoin=function(b){d.donotJoin=b;var c=a.sessionDescriptions[b];c&&(a.socket.send({donotJoin:!0,messageFor:c.userid,sessionid:b}),f={},a.isAcceptNewSession=!0,a.sessionid=null)},this.send=function(b,c){if(b instanceof ArrayBuffer||b instanceof DataView||(b=u({extra:a.extra,userid:a.userid,data:b})),c)return"open"===c.readyState&&c.send(b),void 0;for(var d in a.channels){var e=a.channels[d].channel;"open"===e.readyState&&e.send(b)}},this.leave=function(){P()},this.addStream=function(b){function f(d){var f=d.socket;if(!f)return A(d,"doesn't has socket."),void 0;if(o(f),!d||!d.peer)throw"No peer to renegotiate.";var h=d.peer;return b.stream&&(h.attachStreams=[b.stream]),E(a.detachStreams,h.connection),b.stream&&(c.audio||c.video||c.screen)&&(g||e&&!h.connection.getLocalStreams().length)&&h.addStream(b.stream),e||"firefox"===d.userinfo.browser?d.redial():(h.recreateOffer(c,function(b,d){G({sdp:b,socket:f,renegotiate:c,labels:a.detachStreams,streaminfo:d}),a.detachStreams=[]}),void 0)}var c=b.renegotiate;if(a.renegotiatedSessions[JSON.stringify(b.renegotiate)]||(a.renegotiatedSessions[JSON.stringify(b.renegotiate)]={session:b.renegotiate,stream:b.stream}),b.socket)b.socket.userid!==a.userid&&f(a.peers[b.socket.userid]);else for(var d in a.peers)d!==a.userid&&f(a.peers[d])},a.accept=function(b){arguments.length>1&&r(arguments[0])&&(b={},arguments[0]&&(b.userid=arguments[0]),arguments[1]&&(b.extra=arguments[1]),arguments[2]&&(b.channel=arguments[2])),a.captureUserMedia(function(){X(b)})};var Y=!1;this.disconnect=function(){if(this.isOwnerLeaving=!0,!a.keepStreamsOpened){for(var b in a.localStreams)a.localStreams[b].stop();a.localStreams={},bb={streams:[],mutex:!1,queueRequests:[]}}a.isInitiator&&a.socket.send({isDisconnectSockets:!0}),a.refresh(),a.socket=null,Y=!0,a.ondisconnected({userid:a.userid,extra:a.extra,peer:a.peers[a.userid],isSocketsDisconnected:!0}),a.close(),window.removeEventListener("beforeunload",d.leaveHandler),window.removeEventListener("keyup",d.leaveHandler),y("Disconnected your sockets, peers, streams and everything except RTCMultiConnection object.")}}function c(a){if(!a)throw"MediaStream is mandatory.";if(a.getVideoTracks&&!a.getVideoTracks().length)return a;var c=new AudioContext,d=c.createMediaStreamSource(a),e=c.createMediaStreamDestination();return d.connect(e),b.push(d),e.stream}function l(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var a=window.crypto.getRandomValues(new Uint32Array(3)),b="",c=0,d=a.length;d>c;c++)b+=a[c].toString(36);return b}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function p(a){return!a.audio&&!a.video&&!a.screen&&a.data}function q(a){return"undefined"==typeof a}function r(a){return"string"==typeof a}function s(a){var b=JSON.stringify(a);return"{}"!==b&&b.split(",").length?!1:!0}function t(a){var b="";try{b=String.fromCharCode.apply(null,new Uint16Array(a))}catch(c){}return b}function u(a){r(a)||(a=JSON.stringify(a));for(var b=new ArrayBuffer(2*a.length),c=new Uint16Array(b),d=0,e=a.length;e>d;d++)c[d]=a.charCodeAt(d);return b}function v(a){for(var b=[],c=a.length,d=0;c>d;d++)a[d]&&a[d]!==!0&&b.push(a[d]);return b}function w(a,b){for(var c in a)b(a[c],c)}function B(a){return JSON.stringify(a,function(a,b){return a=a,b&&b.sdp&&b.sdp.type?(y(b.sdp.type,"	",b.sdp.sdp),""):b},"	")}function C(a){if("object"!=typeof a)throw"Invalid data-type: "+typeof a+"; expected: object";var b=JSON.stringify(a);return"{}"!==b&&b.split(",").length?b.split(",").length:0}function D(a,b){var c=document.createElement(a.isAudio?"audio":"video");if(c.id=a.streamid,i){var d=document.body||document.documentElement;return d.insertBefore(c,d.firstChild),setTimeout(function(){_.attachMediaStream(c,a)},1e3),_.attachMediaStream(c,a)}return c[e?"mozSrcObject":"src"]=e?a:window.webkitURL.createObjectURL(a),c.controls=!0,c.autoplay=!!b.remote,c.muted=b.remote?!1:!0,e&&c.addEventListener("ended",function(){a.onended()},!1),c.play(),c}function F(a,b){(!a.mediaElement||a.mediaElement.parentNode)&&(E[a.streamid]||(E[a.streamid]=a,b.onstreamended(a)))}function H(a,b){G[a.userid]||(G[a.userid]=a,b.onleave(a),b.numberOfConnectedUsers--)}function I(a){function d(a,b){for(var c=atob(a.split(",")[1]),d=[],e=0;e<c.length;e++)d.push(c.charCodeAt(e));return new Blob([new Uint8Array(d)],{type:b})}function e(e){var f=document.createElement("canvas");f.width=e.videoWidth||e.clientWidth,f.height=e.videoHeight||e.clientHeight;var g=f.getContext("2d");if(g.drawImage(e,0,0,f.width,f.height),c.snapshots[b]=f.toDataURL("image/png"),a.callback){var h=d(c.snapshots[b],"image/png");a.callback(c.snapshots[b],h)}}var b=a.userid,c=a.connection;if(a.mediaElement)return e(a.mediaElement);for(var f in c.streams)f=c.streams[f],f.userid===b&&f.stream&&f.stream.getVideoTracks&&f.stream.getVideoTracks().length&&e(f.mediaElement)}function J(a){a.onMediaCaptured&&(a.onMediaCaptured(),delete a.onMediaCaptured)}function K(a,b){if(a||(a={}),!b)return a;for(var c in b)a[c]=b[c];return a}function L(a,b){var c=document.createElement("script");c.src=a,c.onload=function(){y("loaded resource:",a),b&&b()},document.documentElement.appendChild(c)}function M(a){var b=a.connection,c=a.element;if(!window.html2canvas)return L(b.resources.html2canvas,function(){M(a)});if(r(c)&&(c=document.querySelector(c),c||(c=document.getElementById(c))),!c)throw"HTML DOM Element is not accessible!";window.html2canvas(c,{onrendered:function(b){a.callback(b.toDataURL())}})}function N(a,b){function c(a){return a.userid=a.extra.userid,a}if(!window.FileBufferReader)return L(a.resources.FileBufferReader,function(){N(a,b)}),void 0;var d=new window.FileBufferReader;d.onProgress=function(b){a.onFileProgress(c(b),b.uuid)},d.onBegin=function(b){a.onFileStart(c(b))},d.onEnd=function(b){a.onFileEnd(c(b))},b(d)}function Q(a){if(kb.screen.extensionid===W&&!P){if(!a)return Q(!0);P=!0;var b=document.createElement("iframe");b.onload=function(){b.isLoaded=!0,y("Screen Capturing frame is loaded.")},b.src="https://www.webrtc-experiment.com/getSourceId/",b.style.display="none",(document.body||document.documentElement).appendChild(b),O={postMessage:function(){return b.isLoaded?(b.contentWindow.postMessage({captureSourceId:!0},"*"),void 0):(setTimeout(O.postMessage,100),void 0)
}}}}function S(a,b){if(!R){if(!b)return S(a,!0);R=!0;var c=document.createElement("iframe");c.onload=function(){function b(c){c.data&&c.data.iceServers&&(a(c.data.iceServers),window.removeEventListener("message",b))}c.isLoaded=!0,Z("message",b),c.contentWindow.postMessage("get-ice-servers","*")},c.src="https://cdn.webrtc-experiment.com/getIceServers/",c.style.display="none",(document.body||document.documentElement).appendChild(c)}}function T(a){var b=a.stream,c=a.root,d=a.session||{},e=a.enabled;if(d.audio||d.video||(d=r(d)?{audio:!0,video:!0}:K(d,{audio:!0,video:!0})),d.type){if("remote"===d.type&&"remote"!==c.type)return;if("local"===d.type&&"local"!==c.type)return}if(y(e?"Muting":"UnMuting","session",B(d)),"local"===c.type&&d.audio&&b.getAudioTracks){var f=b.getAudioTracks()[0];f&&(f.enabled=!e)}if("local"===c.type&&(d.video||d.screen)&&b.getVideoTracks){var g=b.getVideoTracks()[0];g&&(g.enabled=!e)}if(c.sockets.forEach(function(a){"local"===c.type&&a.send({streamid:c.streamid,mute:!!e,unmute:!e,session:d}),"remote"===c.type&&a.send({promptMuteUnmute:!0,streamid:c.streamid,mute:!!e,unmute:!e,session:d})}),"remote"!==c.type){var h=K({},c);h.session=d,h.isAudio=!!h.session.audio&&!h.session.video,h.isVideo=!!h.session.video,h.isScreen=!!h.session.screen,e&&(b.preMuted={audio:b.getAudioTracks().length&&!b.getAudioTracks()[0].enabled,video:b.getVideoTracks().length&&!b.getVideoTracks()[0].enabled},c.rtcMultiConnection.onmute(h)),e||(b.preMuted={},c.rtcMultiConnection.onunmute(h))}}function Z(a,b){window.removeEventListener(a,b),window.addEventListener(a,b,!1)}function $(a){if(!window.hark)return L(a.connection.resources.hark,function(){$(a)}),void 0;var b=a.connection,c=a.streamedObject,d=a.stream,e={},f=window.hark(d,e);f.on("speaking",function(){b.onspeaking&&b.onspeaking(c)}),f.on("stopped_speaking",function(){b.onsilence&&b.onsilence(c)}),f.on("volume_change",function(a,d){b.onvolumechange&&b.onvolumechange(K({volume:a,threshold:d},c))})}function cb(a){function q(c,d,f){f||(f=l()),b.localStreams[f]=c;var g=a.video;g&&(g[e?"mozSrcObject":"src"]=e?c:window.webkitURL.createObjectURL(c),g.play()),a.onsuccess(c,d,p,f),bb.streams[p]={stream:c,streamid:f},bb.mutex=!1,bb.queueRequests.length&&cb(bb.queueRequests.shift())}if(i)return _.getUserMedia?_.getUserMedia(a.constraints||{audio:!0,video:!0},a.onsuccess,a.onerror):(setTimeout(function(){cb(a)},1e3),void 0);if(bb.mutex===!0)return bb.queueRequests.push(a),void 0;bb.mutex=!0;var b=a.connection,c=a.mediaConstraints||{},d="boolean"==typeof c.video?c.video:c.video||c,f="boolean"==typeof c.audio?c.audio:c.audio||ab,g=navigator,h=a.constraints||{audio:ab,video:ab};h.video&&h.video.mozMediaSource&&(d={}),h.video===!0&&(h.video=ab),h.audio===!0&&(h.audio=ab),"boolean"==typeof f&&h.audio&&(h.audio=f),"boolean"==typeof d&&h.video&&(h.video=d);var k=f.mandatory;if(s(k)||(h.audio.mandatory=K(h.audio.mandatory,k)),h.video!==!1){var m=d.mandatory;if(m){var n={};if(m.minWidth&&(n.minWidth=m.minWidth),m.minHeight&&(n.minHeight=m.minHeight),m.maxWidth&&(n.maxWidth=m.maxWidth),m.maxHeight&&(n.maxHeight=m.maxHeight),m.minAspectRatio&&(n.minAspectRatio=m.minAspectRatio),m.maxFrameRate&&(n.maxFrameRate=m.maxFrameRate),m.minFrameRate&&(n.minFrameRate=m.minFrameRate),n.minWidth&&n.minHeight){var o=["1920:1080","1280:720","960:720","640:360","640:480","320:240","320:180"];(-1===o.indexOf(n.minWidth+":"+n.minHeight)||-1===o.indexOf(n.maxWidth+":"+n.maxHeight))&&z('The min/max width/height constraints you passed "seems" NOT supported.',B(n)),(n.minWidth>n.maxWidth||n.minHeight>n.maxHeight)&&z("Minimum value must not exceed maximum value.",B(n)),n.minWidth>=1280&&n.minHeight>=720&&A("Enjoy HD video! min/"+n.minWidth+":"+n.minHeight+", max/"+n.maxWidth+":"+n.maxHeight)}h.video.mandatory=K(h.video.mandatory,n)}m&&(h.video.mandatory=K(h.video.mandatory,m)),d.optional&&d.optional instanceof Array&&d.optional.length&&(h.video.optional=h.video.optional?h.video.optional.concat(d.optional):d.optional),h.video.mandatory&&!s(h.video.mandatory)&&b._mediaSources.video&&(h.video.optional.forEach(function(a,c){a.sourceId===b._mediaSources.video&&delete h.video.optional[c]}),h.video.optional=v(h.video.optional),h.video.optional.push({sourceId:b._mediaSources.video})),h.video&&!h.video.mozMediaSource&&h.video.optional&&h.video.mandatory&&!h.video.optional.length&&s(h.video.mandatory)&&(h.video=!0)}f.optional&&f.optional instanceof Array&&f.optional.length&&(h.audio.optional=h.audio.optional?h.audio.optional.concat(f.optional):f.optional),h.audio.mandatory&&!s(h.audio.mandatory)&&b._mediaSources.audio&&(h.audio.optional.forEach(function(a,c){a.sourceId===b._mediaSources.audio&&delete h.audio.optional[c]}),h.audio.optional=v(h.audio.optional),h.audio.optional.push({sourceId:b._mediaSources.audio})),j&&(h={audio:!!h.audio,video:!!h.video}),y("invoked getUserMedia with constraints:",B(h));var p=JSON.stringify(h);bb.streams[p]?q(bb.streams[p].stream,!0,bb.streams[p].streamid):(g.getMedia=g.webkitGetUserMedia||g.mozGetUserMedia,g.getMedia(h,q,function(b){a.onerror(b,h)}))}function gb(){return{create:function(a,b){K(this,b);var c=this;return this.type=a,this.init(),this.attachMediaStreams(),e&&this.session.data?(this.session.data&&"offer"===a&&this.createDataChannel(),this.getLocalDescription(a),this.session.data&&"answer"===a&&this.createDataChannel()):c.getLocalDescription(a),this},getLocalDescription:function(a){function c(){b.connection["offer"===a?"createOffer":"createAnswer"](function(c){c.sdp=b.serializeSdp(c.sdp,a),b.connection.setLocalDescription(c),b.trickleIce&&b.onSessionDescription(c,b.streaminfo),"offer"===c.type&&y("offer sdp",c.sdp),b.prevCreateType=a},b.onSdpError,b.constraints)}y("(getLocalDescription) peer createType is",a),this.session.inactive&&q(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing)&&(this.rtcMultiConnection.waitUntilRemoteStreamStartsFlowing=!1);var b=this;"answer"===a?this.setRemoteDescription(this.offerDescription,c):c()},serializeSdp:function(a,b){if(a=this.processSdp(a),e)return a;if(this.session.inactive&&!this.holdMLine&&(this.hold=!0,(this.session.screen||this.session.video)&&this.session.audio?this.holdMLine="both":this.session.screen||this.session.video?this.holdMLine="video":this.session.audio&&(this.holdMLine="audio")),a=this.setBandwidth(a),"both"===this.holdMLine){if(this.hold)this.prevSDP=a,a=a.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive");else if(this.prevSDP&&!this.session.inactive&&(a=this.prevSDP,35>=m))return a}else if("audio"===this.holdMLine||"video"===this.holdMLine){a=a.split("m=");var c="",d="";a[1]&&0===a[1].indexOf("audio")&&(c="m="+a[1]),a[2]&&0===a[2].indexOf("audio")&&(c="m="+a[2]),a[1]&&0===a[1].indexOf("video")&&(d="m="+a[1]),a[2]&&0===a[2].indexOf("video")&&(d="m="+a[2]),"audio"===this.holdMLine&&(this.hold?(this.prevSDP=a[0]+c+d,a=a[0]+c.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")+d):this.prevSDP&&(a=this.prevSDP)),"video"===this.holdMLine&&(this.hold?(this.prevSDP=a[0]+c+d,a=a[0]+c+d.replace(/a=sendonly|a=recvonly|a=sendrecv/g,"a=inactive")):this.prevSDP&&(a=this.prevSDP))}return!this.hold&&this.session.inactive&&(a="offer"===b?a.replace(/a=setup:passive|a=setup:active|a=setup:holdconn/g,"a=setup:actpass"):a.replace(/a=setup:actpass|a=setup:passive|a=setup:holdconn/g,"a=setup:active"),a=a.replace(/a=inactive/g,"a=sendrecv")),a},init:function(){function a(){return b.returnedSDP?(b.returnedSDP=!1,void 0):(b.returnedSDP=!0,b.onSessionDescription(b.connection.localDescription,b.streaminfo),void 0)}this.setConstraints(),this.connection=new db(this.rtcConfiguration,this.optionalArgument),this.session.data&&(y("invoked: createDataChannel"),this.createDataChannel()),this.connection.onicecandidate=function(c){return c.candidate?(b.trickleIce&&b.onicecandidate(c.candidate),void 0):(b.trickleIce||a(),void 0)},this.connection.onaddstream=function(a){y("onaddstream",i?a.stream:B(a.stream)),b.onaddstream(a.stream,b.session)},this.connection.onremovestream=function(a){b.onremovestream(a.stream)},this.connection.onsignalingstatechange=function(){b.connection&&b.oniceconnectionstatechange({iceConnectionState:b.connection.iceConnectionState,iceGatheringState:b.connection.iceGatheringState,signalingState:b.connection.signalingState})},this.connection.oniceconnectionstatechange=function(){b.connection&&(b.oniceconnectionstatechange({iceConnectionState:b.connection.iceConnectionState,iceGatheringState:b.connection.iceGatheringState,signalingState:b.connection.signalingState}),b.trickleIce||"complete"===b.connection.iceGatheringState&&(y("iceGatheringState",b.connection.iceGatheringState),a()))};var b=this},setBandwidth:function(a){if(j||e||!this.bandwidth)return a;var b=this.bandwidth;return this.session.screen&&(b.screen?b.screen<300&&A("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):A("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),b.screen&&this.session.screen&&(a=a.replace(/b=AS([^\r\n]+\r\n)/g,""),a=a.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+b.screen+"\r\n")),(b.audio||b.video||b.data)&&(a=a.replace(/b=AS([^\r\n]+\r\n)/g,"")),b.audio&&(a=a.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+b.audio+"\r\n")),b.video&&(a=a.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+(this.session.screen?b.screen:b.video)+"\r\n")),b.data&&!this.preferSCTP&&(a=a.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:"+b.data+"\r\n")),a},setConstraints:function(){if(this.constraints={optional:this.sdpConstraints.optional||g?[{VoiceActivityDetection:!1}]:[],mandatory:this.sdpConstraints.mandatory||{OfferToReceiveAudio:!!this.session.audio,OfferToReceiveVideo:!!this.session.video||!!this.session.screen}},y("sdp-constraints",B(this.constraints)),this.optionalArgument={optional:this.optionalArgument.optional||[],mandatory:this.optionalArgument.mandatory||{}},this.preferSCTP||this.optionalArgument.optional.push({RtpDataChannels:!0}),y("optional-argument",B(this.optionalArgument)),q(this.rtcConfiguration)||q(this.iceServers))this.rtcConfiguration=null;else{var a=this.rtcMultiConnection.candidates,b=a.stun,c=a.turn,d=a.host;q(a.reflexive)||(b=a.reflexive),q(a.relay)||(c=a.relay),d||b||!c?d||b||c||(this.rtcConfiguration.iceTransports="none"):this.rtcConfiguration.iceTransports="relay",this.rtcConfiguration={iceServers:this.iceServers,iceTransports:this.rtcConfiguration.iceTransports}}y("rtc-configuration",B(this.rtcConfiguration))},onSdpError:function(a){var b=B(a);b&&-1!==b.indexOf("RTP/SAVPF Expects at least 4 fields")&&(b="It seems that you are trying to interop RTP-datachannels with SCTP. It is not supported!"),z("onSdpError:",b)},onSdpSuccess:function(){y("sdp success")},onMediaError:function(a){z(B(a))},setRemoteDescription:function(a,b){if(!a)throw"Remote session description should NOT be NULL.";if(this.connection){y("setting remote description",a.type,a.sdp);var c=this;this.connection.setRemoteDescription(new eb(a),b||this.onSdpSuccess,function(a){-1===a.search(/STATE_SENTINITIATE|STATE_INPROGRESS/gi)&&c.onSdpError(a)})}},addIceCandidate:function(a){function c(c){b.connection&&b.connection.addIceCandidate(c,function(){y("added:",a.sdpMid,a.candidate)},function(){z("onIceFailure",arguments,a.candidate)})}var b=this;i?new fb(a,function(a){c(a)}):c(new fb(a))},createDataChannel:function(a){if(!this.channels||!this.channels.length){var b=this;this.channels||(this.channels=[]);var c={};this.dataChannelDict&&(c=this.dataChannelDict),g&&!this.preferSCTP&&(c.reliable=!1),y("dataChannelDict",B(c)),("answer"===this.type||e)&&(this.connection.ondatachannel=function(a){b.setChannelEvents(a.channel)}),(g&&"offer"===this.type||e)&&this.setChannelEvents(this.connection.createDataChannel(a||"channel",c))}},setChannelEvents:function(a){var b=this;a.binaryType="arraybuffer",this.dataChannelDict.binaryType&&(a.binaryType=this.dataChannelDict.binaryType),a.onmessage=function(a){b.onmessage(a.data)};var c=0;a.onopen=function(){a.push=a.send,a.send=function(d){if("disconnected"!==b.connection.iceConnectionState&&-1===a.readyState.search(/closing|closed/g)&&-1!==a.readyState.search(/connecting|open/g)){if("connecting"===a.readyState)return c++,setTimeout(function(){if(!(20>c))throw"Number of times exceeded to wait for WebRTC data connection to be opened.";a.send(d)},1e3);try{a.push(d)}catch(e){if(c++,A("Data transmission failed. Re-transmitting..",c,B(e)),c>=20)throw"Number of times exceeded to resend data packets over WebRTC data channels.";setTimeout(function(){a.send(d)},100)}}},b.onopen(a)},a.onerror=function(a){b.onerror(a)},a.onclose=function(a){b.onclose(a)},this.channels.push(a)},addStream:function(a){a.streamid||h||(a.streamid=l()),y("attaching stream:",a.streamid,i?a:B(a)),this.connection.addStream(a),this.sendStreamId(a),this.getStreamInfo()},attachMediaStreams:function(){for(var a=this.attachStreams,b=0;b<a.length;b++)this.addStream(a[b])},getStreamInfo:function(){this.streaminfo="";for(var a=this.connection.getLocalStreams(),b=0;b<a.length;b++)0===b?this.streaminfo=JSON.stringify({streamid:a[b].streamid||"",isScreen:!!a[b].isScreen,isAudio:!!a[b].isAudio,isVideo:!!a[b].isVideo,preMuted:a[b].preMuted||{}}):this.streaminfo+="----"+JSON.stringify({streamid:a[b].streamid||"",isScreen:!!a[b].isScreen,isAudio:!!a[b].isAudio,isVideo:!!a[b].isVideo,preMuted:a[b].preMuted||{}})},recreateOffer:function(a,b){y("recreating offer"),this.type="offer",this.renegotiate=!0,this.session=a,this.onSessionDescription=b,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("offer")},recreateAnswer:function(a,b,c){y("recreating answer"),this.type="answer",this.renegotiate=!0,this.session=b,this.onSessionDescription=c,this.offerDescription=a,this.getStreamInfo(),this.session.data&&this.createDataChannel(),this.getLocalDescription("answer")}}}function ib(a){function c(c,d,e){var f=c.uuid;if(b[f]||(b[f]=[]),b[f].push(c.message),c.last){var g=b[f].join("");c.isobject&&(g=JSON.parse(g));var h=(new Date).getTime(),i=h-c.sendingTime,j={data:g,userid:d,extra:e,latency:i};g.preRecordedMediaChunk?(a.preRecordedMedias[g.streamerid]||a.shareMediaFile(null,null,g.streamerid),a.preRecordedMedias[g.streamerid].onData(g.chunk)):a.autoTranslateText?(j.original=j.data,a.Translator.TranslateText(j.data,function(b){j.data=b,a.onmessage(j)})):g.isPartOfScreen?a.onpartofscreen(g):a.onmessage(j),delete b[f]}}var b={};return{receive:c}}window.RMCDefaultChannel=location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""),window.RTCMultiConnection=function(b){function u(b){return O&&Q(),t?b():(t=new a(n,b),void 0)}function x(a,b){if(r(a)&&(n.skipOnNewSession=!0),!t)return y("Signaling channel is not ready. Connecting..."),u(function(){y("Signaling channel is connected. Joining the session again..."),setTimeout(function(){x(a,b)},1e3)}),void 0;if(r(a)){if(!n.sessionDescriptions[a])return setTimeout(function(){y("Session-Descriptions not found. Rechecking.."),x(a,b)},1e3);a=n.sessionDescriptions[a]}if(b)return E(function(){a.oneway=!0,x(a)},b);if(!a||!a.userid||!a.sessionid){z("missing arguments",arguments);var c='Invalid data passed over "connection.join" method.';throw n.onstatechange({userid:"browser",extra:{},name:"Unexpected data detected.",reason:c}),c}n.dontOverrideSession||(n.session=a.session);var d=n.extra||a.extra||{};a.oneway||p(a)?t.joinSession(a,d):E(function(){t.joinSession(a,d)})}function E(a,b,c){function i(c){if(c.data&&c.data.chromeMediaSourceId){window.removeEventListener("message",i);var e=c.data.chromeMediaSourceId;if(kb.screen.sourceId=e,kb.screen.chromeMediaSource="desktop","PermissionDeniedError"===e){var f={message:"https:"===location.protocol?"User denied to share content of his screen.":V,name:"PermissionDeniedError",constraintName:h,session:d};return bb.mutex=!1,kb.screen.sourceId=null,n.onMediaError(f)}E(a,b)}c.data&&c.data.chromeExtensionStatus&&(A("Screen capturing extension status is:",c.data.chromeExtensionStatus),kb.screen.chromeMediaSource="screen",E(a,b,!0))}function l(b,c,i,j){if(n.onstatechange({userid:"browser",extra:{},name:"fetching-usermedia",reason:"About to capture user-media with constraints: "+B(b)}),n.preventSSLAutoAllowed&&!j&&g)return navigator.customGetUserMediaBar?(navigator.customGetUserMediaBar(b,function(){l(b,c,i,!0)},function(){n.onMediaError({name:"PermissionDeniedError",message:"User denied permission.",constraintName:b,session:d})}),void 0):(L(n.resources.customGetUserMediaBar,function(){l(b,c,i,j)}),void 0);var m={onsuccess:function(a,e,g,j){G(a,e,g,j,b,c,i,h,f,d)},onerror:function(b,c){var f;if(e&&"PERMISSION_DENIED"===b&&(b={message:"",name:"PermissionDeniedError",constraintName:c,session:d}),e&&c.video&&c.video.mozMediaSource)return f={message:U,name:b.name||"PermissionDeniedError",constraintName:c,session:d},n.onMediaError(f),void 0;if(r(b))return n.onMediaError({message:"Unknown Error",name:b,constraintName:c,session:d});!b.name||"PermissionDeniedError"!==b.name&&"DevicesNotFoundError"!==b.name||(f="Either: ",f+="\n Media resolutions are not permitted.",f+="\n Another application is using same media device.",f+="\n Media device is not attached or drivers not installed.",f+="\n You denied access once and it is still denied.",b.message&&b.message.length&&(f+="\n "+b.message),f={message:f,name:b.name,constraintName:c,session:d},n.onMediaError(f),g&&(d.audio||d.video)&&kb.load(function(){d.audio&&!kb.hasMicrophone&&(A("It seems that you have no microphone attached to your device/system."),d.audio=d.audio=!1,d.video||(alert("It seems that you are capturing microphone and there is no device available or access is denied. Reloading..."),location.reload())),d.video&&!kb.hasWebcam&&(A("It seems that you have no webcam attached to your device/system."),d.video=d.video=!1,d.audio||(alert("It seems that you are capturing webcam and there is no device available or access is denied. Reloading..."),location.reload())),kb.hasMicrophone||kb.hasWebcam?n.getUserMediaPromptedOnce||(n.getUserMediaPromptedOnce=!0,E(a,d)):(alert("It seems that either both microphone/webcam are not available or access is denied. Reloading..."),location.reload())})),b.name&&"ConstraintNotSatisfiedError"===b.name&&(f="Either: ",f+="\n You are prompting unknown media resolutions.",f+="\n You are using invalid media constraints.",b.message&&b.message.length&&(f+="\n "+b.message),f={message:f,name:b.name,constraintName:c,session:d},n.onMediaError(f)),d.screen&&(e?z(U):"https:"!==location.protocol?k||"file:"!==location.protocol&&"http:"!==location.protocol||z("You cannot use HTTP or file protocol for screen capturing. You must either use HTTPs or chrome extension page or Node-Webkit page."):z('Unable to detect actual issue. Maybe "deprecated" screen capturing flag was not set using command line or maybe you clicked "No" button or maybe chrome extension returned invalid "sourceId". Please install chrome-extension: http://bit.ly/webrtc-screen-extension')),bb.mutex=!1;var h=JSON.stringify(c);bb.streams[h]&&delete bb.streams[h]},mediaConstraints:n.mediaConstraints||{}};m.constraints=b||f,m.connection=n,cb(m)}var d=b||n.session;if(s(d))return a&&a(),void 0;if(n.dontCaptureUserMedia)return a();if(p(d)||!n.isInitiator&&d.oneway)return n.attachStreams=[],a();var f={audio:d.audio?{mandatory:{},optional:[{chromeRenderToAssociatedSink:!0}]}:!1,video:!!d.video};if(n._mediaSources.audio&&f.audio.optional.push({sourceId:n._mediaSources.audio}),n._mediaSources.video&&(f.video={optional:[{sourceId:n._mediaSources.video}]}),!d.screen&&!f.audio&&!f.video)return a();var h={audio:!1,video:{mandatory:{chromeMediaSource:kb.screen.chromeMediaSource,maxWidth:screen.width>1920?screen.width:1920,maxHeight:screen.height>1080?screen.height:1080},optional:[]}};if(e&&d.screen){if("https:"!==location.protocol)return z(V);A(U),h.video=K(h.video.mandatory,{mozMediaSource:"window",mediaSource:"window"}),f.audio&&(h.audio=!0,f={}),delete h.video.chromeMediaSource}if(d.screen){if(g&&kb.screen.extensionid!==W&&(X=!0),g&&!X&&!c&&!kb.screen.sourceId)return Z("message",i),O||Q(),O.postMessage(),void 0;if(g&&X&&!c&&"screen"===kb.screen.chromeMediaSource&&kb.screen.extensionid)return kb.screen.extensionid===W&&-1===document.domain.indexOf("webrtc-experiment.com")?E(a,b,!0):(y("checking if chrome extension is installed."),kb.screen.getChromeExtensionStatus(function(c){"installed-enabled"===c&&(kb.screen.chromeMediaSource="desktop"),E(a,b,!0),y("chrome extension is installed?","desktop"===kb.screen.chromeMediaSource)}),void 0);if(g&&X&&"desktop"===kb.screen.chromeMediaSource&&!kb.screen.sourceId)return kb.screen.getSourceId(function(c){if("PermissionDeniedError"===c){var e={message:"User denied to share content of his screen.",name:"PermissionDeniedError",constraintName:h,session:d};return bb.mutex=!1,kb.screen.chromeMediaSource="desktop",n.onMediaError(e)}return"No-Response"===c?(z("Chrome extension seems not available. Make sure that manifest.json#L16 has valid content-script matches pointing to your URL."),kb.screen.chromeMediaSource="screen",E(a,b,!0)):(E(a,b,!0),void 0)}),void 0;g&&"desktop"===kb.screen.chromeMediaSource&&(h.video.mandatory.chromeMediaSourceId=kb.screen.sourceId);var j=C;l(h,f.audio||f.video?function(){j&&(C=!0),l(f,a)}:a)}else l(f,a,d.audio&&!d.video)}function G(a,b,d,e,f,g,i,j,k,m){e||(e=l()),n.onstatechange({userid:"browser",extra:{},name:"usermedia-fetched",reason:"Captured user media using constraints: "+B(f)}),i&&(a=c(a)),n.localStreamids.push(e),a.onended=function(){p.mediaElement&&!p.mediaElement.parentNode&&document.getElementById(a.streamid)&&(p.mediaElement=document.getElementById(a.streamid)),n.attachStreams.forEach(function(b,c){b===a&&(delete n.attachStreams[c],n.attachStreams=v(n.attachStreams))}),F(p,n),n.streams[e]&&n.removeStream(e);var b=n.streams[e];b&&b.sockets.length&&b.sockets.forEach(function(a){a.send({streamid:b.streamid,stopped:!0})}),bb.mutex=!1,bb.streams[d]&&delete bb.streams[d],kb.screen.sourceId=null},h||(a.streamid=e,a.isScreen=f===j,a.isVideo=f===k&&!!k.video,a.isAudio=f===k&&!!k.audio&&!k.video,a.preMuted={audio:a.getAudioTracks().length&&!a.getAudioTracks()[0].enabled,video:a.getVideoTracks().length&&!a.getVideoTracks()[0].enabled});var o=D(a,m);o.muted=!0;var p={stream:a,streamid:e,mediaElement:o,blobURL:o.mozSrcObject?URL.createObjectURL(a):o.src,type:"local",userid:n.userid,extra:n.extra,session:m,isVideo:!!a.isVideo,isAudio:!!a.isAudio,isScreen:!!a.isScreen,isInitiator:!!n.isInitiator,rtcMultiConnection:n};C&&n.attachStreams.push(a),C=!1,n.streams[e]=n._getStream(p),b||n.onstream(p),n.setDefaultEventsForMediaElement&&n.setDefaultEventsForMediaElement(o,e),g&&g(a,p),n.onspeaking&&$({stream:a,streamedObject:p,connection:n})}function P(a,b){if(-1!==a.position){var c=+a.position.toFixed(2).split(".")[1]||100;b.innerHTML=c+"%"}}var t,n=this;n.channel=b||RMCDefaultChannel,n.isAcceptNewSession=!0,n.open=function(a){n.isAcceptNewSession=!1,n.isInitiator=!0;var b=!1;return a&&(r(a)?n.sessionid=a:(q(a.transmitRoomOnce)||(n.transmitRoomOnce=a.transmitRoomOnce),q(a.dontTransmit)||(b=a.dontTransmit),q(a.sessionid)||(n.sessionid=a.sessionid))),n.socket&&n.socket.remove&&n.socket.remove(),n.sessionid||(n.sessionid=n.channel),n.sessionDescription={sessionid:n.sessionid,userid:n.userid,session:n.session,extra:n.extra},n.sessionDescriptions[n.sessionDescription.sessionid]||(n.numberOfSessions++,n.sessionDescriptions[n.sessionDescription.sessionid]=n.sessionDescription),u(function(){t.captureUserMediaOnDemand=a?!!a.captureUserMediaOnDemand:!1,a&&a.onMediaCaptured&&(n.onMediaCaptured=a.onMediaCaptured),t.captureUserMediaOnDemand||E(function(){t.initSession({sessionDescription:n.sessionDescription,dontTransmit:b}),J(n)}),t.captureUserMediaOnDemand&&t.initSession({sessionDescription:n.sessionDescription,dontTransmit:b})}),n.sessionDescription},n.connect=function(a){return a&&(n.sessionid=a),u(function(){y("Signaling channel is ready.")}),this},n.join=x,n.send=function(a,b){if(n.numberOfConnectedUsers<=0)return setTimeout(function(){n.send(a,b)},1e3),void 0;if(!a)throw"No file, data or text message to share.";if(a instanceof Array&&!q(a[0].size)&&!q(a[0].type))for(var c=0;c<a.length;c++)a[c].size&&a[c].type&&n.send(a[c],b);else if(q(a.size)||q(a.type))jb.send({text:a,channel:t,_channel:b,connection:n});else{if(!n.enableFileSharing)throw'"enableFileSharing" boolean MUST be "true" to support file sharing.';if(!t.fileBufferReader)return N(n,function(c){t.fileBufferReader=c,n.send(a,b)}),void 0;var d=K({userid:n.userid},a.extra||n.extra);t.fileBufferReader.readAsArrayBuffer(a,function(a){t.fileBufferReader.getNextChunk(a,function(a){b?b.send(a):t.send(a)})},d)}},n.disconnect=function(){t&&t.disconnect(),t=null};var C=!0;n.captureUserMedia=E,n.leave=function(a){return t?(C=!0,a?(n.eject(a),void 0):(t.leave(),void 0)):void 0},n.eject=function(a){if(!n.isInitiator)throw"Only session-initiator can eject a user.";if(!n.peers[a])throw"You ejected invalid user.";n.peers[a].sendCustomMessage({ejected:!0})},n.close=function(){n.autoCloseEntireSession=!0,n.leave()},n.renegotiate=function(a,b){return n.numberOfConnectedUsers<=0?(setTimeout(function(){n.renegotiate(a,b)},1e3),void 0):(t.addStream({renegotiate:b||K({oneway:!0},n.session),stream:a}),void 0)},n.attachExternalStream=function(a,b){var c={};a.getAudioTracks&&a.getAudioTracks().length&&(c.audio=!0),a.getVideoTracks&&a.getVideoTracks().length&&(c.video=!0);var d={video:{chromeMediaSource:"external-stream"}},e=b?d:c;G(a,!1,"",null,e,!1,!1,d,c,c)},n.addStream=function(a,b){function d(c){t.addStream({stream:c,renegotiate:a||n.session,socket:b})}if(n.numberOfConnectedUsers<=0)return setTimeout(function(){n.addStream(a,b)},1e3),void 0;if(a){var c;!n.isInitiator&&a.oneway&&(a.oneway=!1,c=!0),E(function(b){c&&(a.oneway=!0),d(b)},a)}else d()},n.removeStream=function(a,b){function c(a,b){b.local&&"local"!==a.type||b.remote&&"remote"!==a.type||(b.screen&&a.isScreen&&n.detachStreams.push(a.streamid),b.audio&&a.isAudio&&n.detachStreams.push(a.streamid),b.video&&a.isVideo&&n.detachStreams.push(a.streamid),b.audio||b.video||b.screen||n.detachStreams.push(a.streamid),-1!==n.detachStreams.indexOf(a.streamid)&&(y("removing stream",a.streamid),F(a,n),b.stop&&n.stopMediaStream(a.stream)))}if(n.numberOfConnectedUsers<=0)return setTimeout(function(){n.removeStream(a,b)},1e3),void 0;a||(a="all");var d;if(!r(a)||-1!==a.search(/all|audio|video|screen/gi)){for(d in n.streams)if(-1===n._skip.indexOf(d)){var e=n.streams[d];if("all"===a)c(e,{audio:!0,video:!0,screen:!0});else if(r(a)){var f={};f[a]=!0,c(e,f)}else c(e,a)}return!b&&n.detachStreams.length&&n.renegotiate(),void 0}return(d=n.streams[a])?(n.detachStreams.push(d.streamid),y("removing stream",d.streamid),F(d,n),b||n.renegotiate(),void 0):A("No such stream exists. Stream-id:",a)},n.switchStream=function(a){return n.numberOfConnectedUsers<=0?(setTimeout(function(){n.switchStream(a)},1e3),void 0):(n.removeStream("all",!0),n.addStream(a),void 0)},n.sendCustomMessage=function(a){return n.socket?(n.socket.send({customMessage:!0,message:a}),void 0):setTimeout(function(){n.sendCustomMessage(a)},1e3)},n.userid=l(),n.session={audio:!0,video:!0},n.maxParticipantsAllowed=256,n.direction="many-to-many",n.mediaConstraints={mandatory:{},optional:[],audio:{mandatory:{},optional:[]},video:{mandatory:{},optional:[]}},n.candidates={host:!0,stun:!0,turn:!0},n.sdpConstraints={},n.sdpConstraints.mandatory={OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},n.privileges={canStopRemoteStream:!1,canMuteRemoteStream:!1},n.iceProtocols={tcp:!0,udp:!0},n.preferSCTP=e||m>=32?!0:!1,n.chunkInterval=e||m>=32?100:500,n.chunkSize=e||m>=32?13e3:1e3,n.fakeDataChannels=!1,n.waitUntilRemoteStreamStartsFlowing=null,n.leaveOnPageUnload=!0,n.getExternalIceServers=g,n.UA={isFirefox:e,isChrome:g,isMobileDevice:j,version:g?m:o,isNodeWebkit:k,isSafari:f,isIE:h,isOpera:d},n.fileQueue={},n.renegotiatedSessions={},n.channels={},n.extra={},n.bandwidth={screen:300},n.caniuse={RTCPeerConnection:kb.isWebRTCSupported,getUserMedia:!!navigator.webkitGetUserMedia||!!navigator.mozGetUserMedia,AudioContext:kb.isAudioContextSupported,ScreenSharing:kb.isScreenCapturingSupported,RtpDataChannels:kb.isRtpDataChannelsSupported,SctpDataChannels:kb.isSctpDataChannelsSupported},n.snapshots={},n._mediaSources={},n.devices={},n.language="en",n.autoTranslateText=!1,n.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",n.localStreamids=[],n.localStreams={},n.preRecordedMedias={},n.attachStreams=[],n.detachStreams=[],n.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300}],mandatory:{}},n.dataChannelDict={},n.dontAttachStream=!1,n.dontCaptureUserMedia=!1,n.preventSSLAutoAllowed=!1,n.autoReDialOnFailure=!0,n.isInitiator=!1,n.DetectRTC=kb,n.trickleIce=!0,n.sessionDescriptions={},n.sessionDescription=null,n.resources={RecordRTC:"https://cdn.webrtc-experiment.com/RecordRTC.js",PreRecordedMediaStreamer:"https://cdn.webrtc-experiment.com/PreRecordedMediaStreamer.js",customGetUserMediaBar:"https://cdn.webrtc-experiment.com/navigator.customGetUserMediaBar.js",html2canvas:"https://cdn.webrtc-experiment.com/screenshot.js",hark:"https://cdn.webrtc-experiment.com/hark.js",firebase:"https://cdn.webrtc-experiment.com/firebase.js",firebaseio:"https://chat.firebaseIO.com/",muted:"https://cdn.webrtc-experiment.com/images/muted.png",getConnectionStats:"https://cdn.webrtc-experiment.com/getConnectionStats.js",FileBufferReader:"https://cdn.webrtc-experiment.com/FileBufferReader.js"},n.body=document.body||document.documentElement,n.peers={},n.firebase="chat",n.numberOfSessions=0,n.numberOfConnectedUsers=0,n.enableFileSharing=!0,n.autoSaveToDisk=!1,n.processSdp=function(a){return a},n.onmessage=function(a){y("onmessage",B(a))},n.onopen=function(a){y("Data connection is opened between you and",a.userid)},n.onerror=function(a){z(onerror,B(a))},n.onclose=function(a){A("onclose",B(a)),n.streams.remove({userid:a.userid})};var H={};n.onFileStart=function(a){var b=document.createElement("div");b.title=a.name,b.innerHTML="<label>0%</label> <progress></progress>",n.body.insertBefore(b,n.body.firstChild),H[a.uuid]={div:b,progress:b.querySelector("progress"),label:b.querySelector("label")},H[a.uuid].progress.max=a.maxChunks},n.onFileProgress=function(a){var b=H[a.uuid];b&&(b.progress.value=a.currentPosition||a.maxChunks||b.progress.max,P(b.progress,b.label))},n.onFileEnd=function(a){H[a.uuid]&&(H[a.uuid].div.innerHTML='<a href="'+a.url+'" target="_blank" download="'+a.name+'">'+a.name+"</a>"),(n.onFileSent||n.onFileReceived)&&(n.onFileSent&&n.onFileSent(a,a.uuid),n.onFileReceived&&n.onFileReceived(a.name,a))},n.onstream=function(a){n.body.insertBefore(a.mediaElement,n.body.firstChild)},n.onstreamended=function(a){if(y("onStreamEndedHandler:",a),!a.mediaElement)return A("Event.mediaElement is undefined",a);if(!a.mediaElement.parentNode){if(a.mediaElement=document.getElementById(a.streamid),!a.mediaElement)return A("Event.mediaElement is undefined",a);if(!a.mediaElement.parentNode)return A("Event.mediElement.parentNode is null.",a)}a.mediaElement.parentNode.removeChild(a.mediaElement)},n.onSessionClosed=function(a){a.isEjected?A(a.userid,"ejected you."):A("Session has been closed.",a)},n.onmute=function(a){a.isVideo&&a.mediaElement&&(a.mediaElement.pause(),a.mediaElement.setAttribute("poster",a.snapshot||n.resources.muted)),a.isAudio&&a.mediaElement&&(a.mediaElement.muted=!0)},n.onunmute=function(a){a.isVideo&&a.mediaElement&&(a.mediaElement.play(),a.mediaElement.removeAttribute("poster")),a.isAudio&&a.mediaElement&&(a.mediaElement.muted=!1)},n.onleave=function(a){y("onleave",B(a))},n.token=l,n.peers[n.userid]={drop:function(){n.drop()},renegotiate:function(){},addStream:function(){},hold:function(){},unhold:function(){},changeBandwidth:function(){},sharePartOfScreen:function(){}},n._skip=["stop","mute","unmute","_private","_selectStreams","selectFirst","selectAll","remove"],n.streams={mute:function(a){this._private(a,!0)
},unmute:function(a){this._private(a,!1)},_private:function(a,b){function c(a,b,c){b.local&&"local"!==a.type||b.remote&&"remote"!==a.type||!(b.screen&&!a.isScreen||b.audio&&!a.isAudio||b.video&&!a.isVideo||(c?!a.mute(b):!a.unmute(b)))}var d;if(!a||r(a))for(d in this)-1===n._skip.indexOf(d)&&this[d]._private(a,b);else for(d in this)-1===n._skip.indexOf(d)&&c(this[d],a,b)},stop:function(a){function e(a,b){b.userid&&a.userid!==b.userid||b.local&&"local"!==a.type||b.remote&&"remote"!==a.type||(b.screen&&a.isScreen&&a.stop(),b.audio&&a.isAudio&&a.stop(),b.video&&a.isVideo&&a.stop(),b.audio||b.video||b.screen||a.stop())}var b;for(var c in this)if(-1===n._skip.indexOf(c))if(b=this[c],a)if(r(a)){var d={};d[a]=!0,e(b,d)}else e(b,a);else b.stop()},remove:function(a){function e(a,b){b.userid&&a.userid!==b.userid||b.local&&"local"!==a.type||b.remote&&"remote"!==a.type||(b.screen&&a.isScreen&&f(a),b.audio&&a.isAudio&&f(a),b.video&&a.isVideo&&f(a),b.audio||b.video||b.screen||f(a))}function f(a){F(a,n),delete n.streams[a.streamid]}var b;for(var c in this)if(-1===n._skip.indexOf(c))if(b=this[c],a)if(r(a)){var d={};d[a]=!0,e(b,d)}else e(b,a);else e(b,{local:!0,remote:!0})},selectFirst:function(a){return this._selectStreams(a,!1)},selectAll:function(a){return this._selectStreams(a,!0)},_selectStreams:function(a,b){if(!a||r(a)||s(a))throw"Invalid arguments.";q(a.local)&&q(a.remote)&&q(a.userid)&&(a.local=a.remote=!0),a.isAudio||a.isVideo||a.isScreen||(a.isAudio=a.isVideo=a.isScreen=!0);var c=[];for(var d in this)-1===n._skip.indexOf(d)&&(d=this[d])&&(a.local&&"local"===d.type||a.remote&&"remote"===d.type||a.userid&&d.userid===a.userid)&&(a.isVideo&&d.isVideo&&c.push(d),a.isAudio&&d.isAudio&&c.push(d),a.isScreen&&d.isScreen&&c.push(d));return b?c:c[0]}};var R=[];R.push({url:"stun:stun.l.google.com:19302"}),R.push({url:"stun:stun.anyfirewall.com:3478"}),R.push({url:"turn:turn.bistri.com:80",credential:"homeo",username:"homeo"}),R.push({url:"turn:turn.anyfirewall.com:443?transport=tcp",credential:"webrtc",username:"webrtc"}),n.iceServers=R,n.rtcConfiguration={iceServers:null,iceTransports:"all",peerIdentity:!1},n.media={min:function(a,b){n.mediaConstraints.video&&(n.mediaConstraints.video.mandatory||(n.mediaConstraints.video.mandatory={}),n.mediaConstraints.video.mandatory.minWidth=a,n.mediaConstraints.video.mandatory.minHeight=b)},max:function(a,b){n.mediaConstraints.video&&(n.mediaConstraints.video.mandatory||(n.mediaConstraints.video.mandatory={}),n.mediaConstraints.video.mandatory.maxWidth=a,n.mediaConstraints.video.mandatory.maxHeight=b)}},n._getStream=function(a){function c(a,b){if(b){var c=b.onpause,d=b.onplay;b.onpause=b.onplay=function(){},a?b.pause():b.play(),b.onpause=c,b.onplay=d}}var b=K({sockets:a.socket?[a.socket]:[]},a);return b.stop=function(){var a=this;if(a.sockets.forEach(function(b){"local"===a.type&&b.send({streamid:a.streamid,stopped:!0}),"remote"===a.type&&b.send({promptStreamStop:!0,streamid:a.streamid})}),"remote"!==a.type){var b=a.stream;b&&a.rtcMultiConnection.stopMediaStream(b)}},b.mute=function(a){this.muted=!0,this._private(a,!0)},b.unmute=function(a){this.muted=!1,this._private(a,!1)},b._private=function(a,b){return a&&!q(a.sync)&&a.sync===!1?(c(b,this.mediaElement),void 0):(T({root:this,session:a,enabled:b,stream:this.stream}),void 0)},b.startRecording=function(a){var b=this;return a||(a={audio:!0,video:!0}),r(a)&&(a={audio:"audio"===a,video:"video"===a}),window.RecordRTC?(y("started recording session",a),b.videoRecorder=b.audioRecorder=null,e?a.video?b.videoRecorder=new window.RecordRTC(b.stream,{type:"video"}):a.audio&&(b.audioRecorder=new window.RecordRTC(b.stream,{type:"audio"})):g&&(a.video&&(b.videoRecorder=new window.RecordRTC(b.stream,{type:"video"})),a.audio&&(b.audioRecorder=new window.RecordRTC(b.stream,{type:"audio"}))),b.audioRecorder&&b.audioRecorder.startRecording(),b.videoRecorder&&b.videoRecorder.startRecording(),void 0):L(b.rtcMultiConnection.resources.RecordRTC,function(){b.startRecording(a)})},b.stopRecording=function(a,b){b||(b={audio:!0,video:!0}),r(b)&&(b={audio:"audio"===b,video:"video"===b}),y("stopped recording session",b);var c=this;b.audio&&c.audioRecorder?c.audioRecorder.stopRecording(function(){b.video&&c.videoRecorder?c.videoRecorder.stopRecording(function(){a({audio:c.audioRecorder.getBlob(),video:c.videoRecorder.getBlob()})}):a({audio:c.audioRecorder.getBlob()})}):b.video&&c.videoRecorder&&c.videoRecorder.stopRecording(function(){a({video:c.videoRecorder.getBlob()})})},b.takeSnapshot=function(a){I({mediaElement:this.mediaElement,userid:this.userid,connection:n,callback:a})},b.streamObject=b,b},n.set=function(a){for(var b in a)this[b]=a[b];return this},n.onMediaError=function(a){z("name",a.name),z("constraintName",B(a.constraintName)),z("message",a.message),z("original session",a.session)},n.takeSnapshot=function(a,b){I({userid:a,connection:n,callback:b})},n.saveToDisk=function(a,b){a.size&&a.type?hb.SaveToDisk(URL.createObjectURL(a),b||a.name||a.type.replace("/","-")+a.type.split("/")[1]):hb.SaveToDisk(a,b)},n.selectDevices=function(a,b){function c(a){a&&(n._mediaSources[a.kind]=a.id)}a&&c(this.devices[a]),b&&c(this.devices[b])},n.getDevices=function(a){return kb.MediaDevices.length?(kb.MediaDevices.forEach(function(a){n.devices[a.deviceId]=a}),a&&a(n.devices),void 0):setTimeout(function(){n.getDevices(a)},1e3)},n.getMediaDevices=n.enumerateDevices=function(a){if(!a)throw"callback is mandatory.";n.getDevices(function(){a(n.DetectRTC.MediaDevices)})},n.onCustomMessage=function(a){y("Custom message",a)},n.ondrop=function(a){y("Media connection is dropped by "+a)},n.drop=function(a){a=a||{},n.attachStreams=[];for(var b in n.streams)-1===n._skip.indexOf(b)&&(b=n.streams[b],"local"===b.type?(n.detachStreams.push(b.streamid),F(b,n)):F(b,n));n.sendCustomMessage({drop:!0,dontRenegotiate:q(a.renegotiate)?!0:a.renegotiate})},n.Translator={TranslateText:function(a,b){var c=document.createElement("script");c.type="text/javascript";var d=encodeURIComponent(a),e="method"+n.token();window[e]=function(c){c.data&&c.data.translations[0]&&b&&b(c.data.translations[0].translatedText),c.error&&"Daily Limit Exceeded"===c.error.message&&(A('Text translation failed. Error message: "Daily Limit Exceeded."'),b(a))};var f="https://www.googleapis.com/language/translate/v2?key="+n.googKey+"&target="+(n.language||"en-US")+"&callback=window."+e+"&q="+d;c.src=f,document.getElementsByTagName("head")[0].appendChild(c)}},n.setDefaultEventsForMediaElement=function(a,b){a.onpause=function(){n.streams[b]&&!n.streams[b].muted&&n.streams[b].mute()},a.onplay=function(){n.streams[b]&&n.streams[b].muted&&n.streams[b].unmute()};var c=!1;a.onvolumechange=function(){c||(c=!0,n.streams[b]&&setTimeout(function(){var d=n.streams[b];n.streams[b].sockets.forEach(function(b){b.send({streamid:d.streamid,isVolumeChanged:!0,volume:a.volume})}),c=!1},2e3))}},n.onMediaFile=function(a){y("onMediaFile",a),n.body.appendChild(a.mediaElement)},n.shareMediaFile=function(a,b,c){return c=c||n.token(),window.PreRecordedMediaStreamer?window.PreRecordedMediaStreamer.shareMediaFile({file:a,video:b,streamerid:c,connection:n}):(L(n.resources.PreRecordedMediaStreamer,function(){n.shareMediaFile(a,b,c)}),c)},n.onpartofscreen=function(a){var b=document.createElement("img");b.src=a.screenshot,n.body.appendChild(b)},n.skipLogs=function(){y=z=A=function(){}},n.hold=function(a){for(var b in n.peers)n.peers[b].hold(a)},n.onhold=function(a){y("onhold",a),"audio"!==a.kind&&(a.mediaElement.pause(),a.mediaElement.setAttribute("poster",a.screenshot||n.resources.muted)),"audio"===a.kind&&(a.mediaElement.muted=!0)},n.unhold=function(a){for(var b in n.peers)n.peers[b].unhold(a)},n.onunhold=function(a){y("onunhold",a),"audio"!==a.kind&&(a.mediaElement.play(),a.mediaElement.removeAttribute("poster")),"audio"!==a.kind&&(a.mediaElement.muted=!1)},n.sharePartOfScreen=function(a){function c(){(!n.partOfScreen||n.partOfScreen.sharing)&&M({element:a.element,connection:n,callback:function(d){if(d!==b){b=d;for(var e in n.channels)n.channels[e].send({screenshot:d,isPartOfScreen:!0})}a.once||setTimeout(c,a.interval||200)}})}var b="";c(),n.partOfScreen=K({sharing:!0},a)},n.pausePartOfScreenSharing=function(){for(var a in n.peers)n.peers[a].pausePartOfScreenSharing=!0;n.partOfScreen&&(n.partOfScreen.sharing=!1)},n.resumePartOfScreenSharing=function(){for(var a in n.peers)n.peers[a].pausePartOfScreenSharing=!1;n.partOfScreen&&(n.partOfScreen.sharing=!0)},n.stopPartOfScreenSharing=function(){for(var a in n.peers)n.peers[a].stopPartOfScreenSharing=!0;n.partOfScreen&&(n.partOfScreen.sharing=!1)},n.takeScreenshot=function(a,b){if(!a||!b)throw"Invalid number of arguments.";if(!window.html2canvas)return L(n.resources.html2canvas,function(){n.takeScreenshot(a)});if(r(a)&&(a=document.querySelector(a),a||(a=document.getElementById(a))),!a)throw"HTML Element is inaccessible!";window.html2canvas(a,{onrendered:function(a){b(a.toDataURL())}})},n.onScreenCapturingExtensionAvailable=function(){y("It seems that screen capturing extension is installed and available on your system!")},!i&&kb.screen.onScreenCapturingExtensionAvailable&&(kb.screen.onScreenCapturingExtensionAvailable=function(){n.onScreenCapturingExtensionAvailable()}),n.changeBandwidth=function(a){for(var b in n.peers)n.peers[b].changeBandwidth(a)},n.convertToAudioStream=function(a){c(a)},n.onstatechange=function(a){y("on:state:change ("+a.userid+"):",a.name+":",a.reason||"")},n.onfailed=function(a){return a.peer.numOfRetries||(a.peer.numOfRetries=0),a.peer.numOfRetries++,a.peer.numOfRetries>2?(a.peer.numOfRetries=0,void 0):(e||"firefox"===a.targetuser.browser?(z("ICE connectivity check is failed. Re-establishing peer connection."),a.peer.redial()):(z("ICE connectivity check is failed. Renegotiating peer connection."),a.peer.renegotiate()),void 0)},n.onconnected=function(a){y("Peer connection has been established between you and",a.userid)},n.ondisconnected=function(a){z("Peer connection seems has been disconnected between you and",a.userid),s(n.channels)||n.channels[a.userid]&&(n.channels[a.userid].send({checkingPresence:!0}),setTimeout(function(){return n.peers[a.userid].connected?(delete n.peers[a.userid].connected,void 0):(n.streams.remove({remote:!0,userid:a.userid}),n.remove(a.userid),void 0)},3e3))},n.onstreamid=function(a){y("got remote streamid",a.streamid,"from",a.userid)},n.stopMediaStream=function(a){if(!a)throw"MediaStream argument is mandatory.";if(n.keepStreamsOpened)return a.onended&&a.onended(),void 0;n.localStreams[a.streamid]&&delete n.localStreams[a.streamid],e&&a.onended&&a.onended();var b=Boolean((a.getAudioTracks||a.getVideoTracks)&&(a.getAudioTracks()[0]&&!a.getAudioTracks()[0].stop||a.getVideoTracks()[0]&&!a.getVideoTracks()[0].stop));return!a.getAudioTracks||b?(a.stop&&a.stop(),void 0):(a.getAudioTracks().length&&a.getAudioTracks()[0].stop&&a.getAudioTracks().forEach(function(a){a.stop()}),a.getVideoTracks().length&&a.getVideoTracks()[0].stop&&a.getVideoTracks().forEach(function(a){a.stop()}),void 0)},n.changeBandwidth=function(a){if(!a||r(a)||s(a))throw'Invalid "bandwidth" arguments.';w(n.peers,function(b){b.peer.bandwidth=a}),n.renegotiate()},n.openSignalingChannel=function(a){if(!window.Firebase)return L(n.resources.firebase,function(){n.openSignalingChannel(a)});var b=a.channel||n.channel;n.firebase&&(n.resources.firebaseio=n.resources.firebaseio.replace("//chat.","//"+n.firebase+"."));var c=new window.Firebase(n.resources.firebaseio+b);c.channel=b,c.on("child_added",function(b){a.onmessage(b.val())}),c.send=function(a){for(var b in a)(q(a[b])||"function"==typeof a[b])&&(a[b]=!1);this.push(a)},n.socket||(n.socket=c),c.onDisconnect().remove(),setTimeout(function(){a.callback(c)},1)},n.Plugin=_};var b=[],d=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,e="undefined"!=typeof window.InstallTrigger,f=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,g=!!window.chrome&&!d,h=!!document.documentMode,i=f||h,j=!!navigator.userAgent.match(/Android|iPhone|iPad|iPod|BlackBerry|IEMobile/i),k=!!(window.process&&"object"==typeof window.process&&window.process.versions&&window.process.versions["node-webkit"]);window.MediaStream=window.MediaStream||window.webkitMediaStream,window.AudioContext=window.AudioContext||window.webkitAudioContext;var m=50,n=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);g&&n&&n[2]&&(m=parseInt(n[2],10));var o=50;n=navigator.userAgent.match(/Firefox\/(.*)/),e&&n&&n[1]&&(o=parseInt(n[1],10));var x=window.console||{log:function(){},error:function(){},warn:function(){}},y=function(){x.log(arguments)},z=function(){x.error(arguments)},A=function(){x.warn(arguments)};(g||e||f)&&(y=x.log.bind(x),z=x.error.bind(x),A=x.warn.bind(x));var O,P,R,E={},G={},U='Make sure that you are using Firefox Nightly and you enabled: media.getusermedia.screensharing.enabled flag from about:config page. You also need to add your domain in "media.getusermedia.screensharing.allowed_domains" flag. If you are using WinXP then also enable "media.getusermedia.screensharing.allow_on_old_platforms" flag. NEVER forget to use "only" HTTPs for screen capturing!',V="HTTPs i.e. SSL-based URI is mandatory to use screen capturing.",W="ajhifddimkapgcifgcodmmfdlknahffk",X=-1!==document.domain.indexOf("webrtc-experiment.com"),Y=window.MediaStreamTrack;window.addEventListener||(window.addEventListener=function(a,b,c){a.attachEvent&&a.attachEvent("on"+b,c)}),window.attachEventListener=function(a,b,c,d){a.addEventListener(b,c,d)};var _=window.PluginRTC||{};window.onPluginRTCInitialized=function(a){_=a,Y=_.MediaStreamTrack,db=_.RTCPeerConnection,fb=_.RTCIceCandidate,eb=_.RTCSessionDescription,y(i?"Java-Applet":"ActiveX","plugin has been loaded.")},s(_)||window.onPluginRTCInitialized(_),i&&L("https://cdn.webrtc-experiment.com/Plugin.EveryWhere.js");var ab={mandatory:{},optional:[]},bb={streams:[],mutex:!1,queueRequests:[]},db=window.mozRTCPeerConnection||window.webkitRTCPeerConnection,eb=window.mozRTCSessionDescription||window.RTCSessionDescription,fb=window.mozRTCIceCandidate||window.RTCIceCandidate,hb={SaveToDisk:function(a,b){var c=document.createElement("a");c.href=a,c.target="_blank",c.download=b||a;var d=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});c.dispatchEvent(d)}},jb={send:function(a){function k(a,e){var l={type:"text",uuid:i,sendingTime:j};a&&(e=a,l.packets=parseInt(e.length/f)),e.length>f?l.message=e.slice(0,f):(l.message=e,l.last=!0,l.isobject=h),c.send(l,d),g=e.slice(l.message.length),g.length&&setTimeout(function(){k(null,g)},b.chunkInterval||100)}var b=a.connection;if(a.text instanceof ArrayBuffer||a.text instanceof DataView)return a.channel.send(a.text,a._channel);var c=a.channel,d=a._channel,e=a.text,f=b.chunkSize||1e3,g="",h=!1;r(e)||(h=!0,e=JSON.stringify(e));var i=l(),j=(new Date).getTime();k(e)}},kb={};!function(){function a(a){return(i||e)&&a?(a(),void 0):(Y&&Y.getSources&&(navigator.getMediaDevices=Y.getSources.bind(Y)),navigator.getMediaDevices?(navigator.getMediaDevices(function(b){kb.MediaDevices=[],b.forEach(function(a){"audio"===a.kind&&(a.kind="audioinput"),"video"===a.kind&&(a.kind="videoinput"),a.deviceId||(a.deviceId=a.id),a.id||(a.id=a.deviceId),kb.MediaDevices.push(a),("audioinput"===a.kind||"audio"===a.kind)&&(kb.hasMicrophone=!0),"audiooutput"===a.kind&&(kb.hasSpeakers=!0),("videoinput"===a.kind||"video"===a.kind)&&(kb.hasWebcam=!0)}),a&&a()}),void 0):(y("navigator.getMediaDevices is undefined."),g&&(kb.hasMicrophone=!0,kb.hasSpeakers=!0,kb.hasWebcam=!0),a&&a(),void 0))}kb.hasMicrophone=!1,kb.hasSpeakers=!1,kb.hasWebcam=!1,kb.MediaDevices=[],kb.isWebRTCSupported=!!window.webkitRTCPeerConnection||!!window.mozRTCPeerConnection,kb.isAudioContextSupported=!(!window.AudioContext&&!window.webkitAudioContext||!AudioContext.prototype.createMediaStreamSource),kb.isScreenCapturingSupported=g&&m>=26&&(k?!0:"https:"===location.protocol),kb.isSctpDataChannelsSupported=!!navigator.mozGetUserMedia||g&&m>=25,kb.isRtpDataChannelsSupported=g&&m>=31,new a,kb.load=a;var b;kb.screen={chromeMediaSource:"screen",extensionid:W,getSourceId:function(a){function c(c){return"installed-enabled"===c?(b=a,window.postMessage("get-sourceId","*"),void 0):(kb.screen.chromeMediaSource="screen",a("No-Response"),void 0)}if(!a)throw'"callback" parameter is mandatory.';kb.screen.status?c(kb.screen.status):kb.screen.getChromeExtensionStatus(c)},onMessageCallback:function(a){if(r(a)||a.sourceId){if(y("chrome message",a),"PermissionDeniedError"===a){if(kb.screen.chromeMediaSource="PermissionDeniedError",b)return b("PermissionDeniedError");throw new Error("PermissionDeniedError")}"rtcmulticonnection-extension-loaded"===a&&(kb.screen.chromeMediaSource="desktop",kb.screen.onScreenCapturingExtensionAvailable&&(kb.screen.onScreenCapturingExtensionAvailable(),kb.screen.onScreenCapturingExtensionAvailable=null)),a.sourceId&&(kb.screen.sourceId=a.sourceId,b&&b(kb.screen.sourceId))}},getChromeExtensionStatus:function(a,b){function c(a){kb.screen.status=a,b(a)}if(e)return c("not-chrome");2!==arguments.length&&(b=a,a=this.extensionid);var d=document.createElement("img");d.src="chrome-extension://"+a+"/icon.png",d.onload=function(){kb.screen.chromeMediaSource="screen",window.postMessage("are-you-there","*"),setTimeout(function(){"screen"===kb.screen.chromeMediaSource?c("desktop"===kb.screen.chromeMediaSource?"installed-enabled":"installed-disabled"):c("installed-enabled")},2e3)},d.onerror=function(){c("not-installed")}}}}(),window.addEventListener("message",function(a){a.origin===window.location.origin&&kb.screen.onMessageCallback(a.data)})}();